<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechFlow News Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .article { border: 1px solid #333; margin: 10px 0; padding: 15px; border-radius: 8px; }
        .timestamp { color: #888; font-size: 0.9em; }
        .source { color: #4CAF50; font-weight: bold; }
        .loading { text-align: center; padding: 20px; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 10px; }
        button:hover { background: #45a049; }
        .error { color: #ff6b6b; }
        .success { color: #4CAF50; }
    </style>
</head>
<body>
    <h1>TechFlow Live News Test</h1>
    <button onclick="testLiveNews()">Test Live News APIs</button>
    <button onclick="testTimestamps()">Test Timestamps</button>
    <div id="results"></div>

    <script>
        async function testLiveNews() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="loading">Testing live news APIs...</div>';
            
            try {
                // Test Hacker News API
                console.log('Testing Hacker News API...');
                const hnResponse = await fetch('https://hacker-news.firebaseio.com/v0/topstories.json');
                const hnStories = await hnResponse.json();
                
                if (hnStories.length > 0) {
                    const storyResponse = await fetch(`https://hacker-news.firebaseio.com/v0/item/${hnStories[0]}.json`);
                    const story = await storyResponse.json();
                    
                    results.innerHTML += `
                        <div class="article success">
                            <div class="source">✅ Hacker News API Working</div>
                            <h3>${story.title}</h3>
                            <div class="timestamp">Posted: ${new Date(story.time * 1000).toLocaleString()}</div>
                            <div class="timestamp">Time ago: ${getTimeAgo(new Date(story.time * 1000))}</div>
                        </div>
                    `;
                }
                
                // Test Dev.to API
                console.log('Testing Dev.to API...');
                const devResponse = await fetch('https://dev.to/api/articles?tag=javascript&top=7&per_page=3');
                const devArticles = await devResponse.json();
                
                if (devArticles.length > 0) {
                    const article = devArticles[0];
                    results.innerHTML += `
                        <div class="article success">
                            <div class="source">✅ Dev.to API Working</div>
                            <h3>${article.title}</h3>
                            <div class="timestamp">Published: ${new Date(article.published_at).toLocaleString()}</div>
                            <div class="timestamp">Time ago: ${getTimeAgo(new Date(article.published_at))}</div>
                        </div>
                    `;
                }
                
                // Test GitHub API
                console.log('Testing GitHub API...');
                const today = new Date();
                const lastWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                const dateStr = lastWeek.toISOString().split('T')[0];
                
                const ghResponse = await fetch(`https://api.github.com/search/repositories?q=created:>${dateStr}&sort=stars&order=desc&per_page=3`);
                const ghData = await ghResponse.json();
                
                if (ghData.items && ghData.items.length > 0) {
                    const repo = ghData.items[0];
                    results.innerHTML += `
                        <div class="article success">
                            <div class="source">✅ GitHub API Working</div>
                            <h3>${repo.name}: ${repo.description || 'No description'}</h3>
                            <div class="timestamp">Created: ${new Date(repo.created_at).toLocaleString()}</div>
                            <div class="timestamp">Time ago: ${getTimeAgo(new Date(repo.created_at))}</div>
                            <div>⭐ ${repo.stargazers_count} stars</div>
                        </div>
                    `;
                }
                
                // Test RSS API
                console.log('Testing RSS API...');
                const rssResponse = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://feeds.feedburner.com/oreilly/radar&count=3');
                const rssData = await rssResponse.json();
                
                if (rssData.status === 'ok' && rssData.items.length > 0) {
                    const item = rssData.items[0];
                    results.innerHTML += `
                        <div class="article success">
                            <div class="source">✅ RSS API Working</div>
                            <h3>${item.title}</h3>
                            <div class="timestamp">Published: ${new Date(item.pubDate).toLocaleString()}</div>
                            <div class="timestamp">Time ago: ${getTimeAgo(new Date(item.pubDate))}</div>
                        </div>
                    `;
                }
                
            } catch (error) {
                results.innerHTML += `<div class="article error">❌ Error: ${error.message}</div>`;
            }
        }
        
        function testTimestamps() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>Timestamp Test Results</h2>';
            
            const now = new Date();
            const testTimes = [
                { label: 'Just now', time: new Date(now - 30 * 1000) },
                { label: '5 minutes ago', time: new Date(now - 5 * 60 * 1000) },
                { label: '1 hour ago', time: new Date(now - 1 * 60 * 60 * 1000) },
                { label: '3 hours ago', time: new Date(now - 3 * 60 * 60 * 1000) },
                { label: '1 day ago', time: new Date(now - 1 * 24 * 60 * 60 * 1000) },
                { label: '3 days ago', time: new Date(now - 3 * 24 * 60 * 60 * 1000) },
                { label: '1 week ago', time: new Date(now - 7 * 24 * 60 * 60 * 1000) }
            ];
            
            testTimes.forEach(test => {
                results.innerHTML += `
                    <div class="article">
                        <strong>Expected:</strong> ${test.label}<br>
                        <strong>Actual:</strong> ${getTimeAgo(test.time)}<br>
                        <strong>Full Date:</strong> ${test.time.toLocaleString()}
                    </div>
                `;
            });
        }
        
        function getTimeAgo(date) {
            const now = new Date();
            const diffInMinutes = Math.floor((now - date) / (1000 * 60));
            
            if (diffInMinutes < 1) return 'Just now';
            if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
            
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) return `${diffInHours}h ago`;
            
            const diffInDays = Math.floor(diffInHours / 24);
            if (diffInDays === 1) return 'Yesterday';
            if (diffInDays < 7) return `${diffInDays}d ago`;
            
            return date.toLocaleDateString();
        }
    </script>
</body>
</html>